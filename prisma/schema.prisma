// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

enum Role {
  USER
  ADMIN
}

enum StatusUser {
  PENDING_VERIFICATION
  ACTIVE
  BLOCKED
}

model User {
  id              String     @id @default(uuid())
  username        String     @unique @db.VarChar(100)
  firstName       String     @db.VarChar(50)
  lastName        String?    @db.VarChar(100)
  email           String     @unique @db.VarChar(100)
  password        String     @db.VarChar(100)
  role            Role       @default(USER)
  phone           String     @db.VarChar(20)
  profilePictUrl  String?    @db.VarChar(255)
  birthDate       DateTime   @db.Date
  isEmailVerified Boolean    @default(false)
  isPhoneVerified Boolean    @default(false)
  status          StatusUser @default(PENDING_VERIFICATION)

  createdAt DateTime  @default(now()) @db.Timestamptz(3)
  updatedAt DateTime? @updatedAt @db.Timestamptz(3)

  emailVerifiedAt DateTime? @db.Timestamptz(3)
  phoneVerifiedAt DateTime? @db.Timestamptz(3)

  addresses Address[] // one user -> many addresses

  @@map("users")
}

model Address {
  id         String  @id @default(uuid())
  street     String  @db.VarChar(255)
  country    String  @db.VarChar(50)
  postalCode String  @db.VarChar(10)
  locations  Json
  lat        Decimal @db.Decimal(10, 7)
  lng        Decimal @db.Decimal(10, 7)

  createdAt DateTime  @default(now()) @db.Timestamptz(3)
  updatedAt DateTime? @updatedAt @db.Timestamptz(3)

  userId String
  user   User   @relation(fields: [userId], references: [id])

  subdistrictId String
  subdistrict   MasterSubdistrict @relation(fields: [subdistrictId], references: [id])

  @@map("addresses")
}

model MasterProvince {
  id   String @id @default(uuid())
  name String @db.VarChar(255)
  code String @db.VarChar(10)

  masterCity MasterCity[] // one province -> many cities

  @@map("master_provinces")
}

model MasterCity {
  id       String @id @default(uuid())
  name     String @db.VarChar(255)
  code     String @db.VarChar(10)
  province Json

  masterDistrict MasterDistrict[] // one city -> many districts

  provinceId     String
  masterProvince MasterProvince @relation(fields: [provinceId], references: [id])

  @@map("master_cities")
}

model MasterDistrict {
  id       String @id @default(uuid())
  name     String @db.VarChar(255)
  code     String @db.VarChar(10)
  province Json
  city     Json

  masterSubdistricts MasterSubdistrict[] // one district -> many subdistricts

  cityId     String
  masterCity MasterCity @relation(fields: [cityId], references: [id])

  @@map("master_districts")
}

model MasterSubdistrict {
  id       String @id @default(uuid())
  name     String @db.VarChar(255)
  code     String @db.VarChar(10)
  province Json
  city     Json
  district Json

  addresses Address[] // one subdictricts -> many addresses

  districtId     String
  masterDistrict MasterDistrict @relation(fields: [districtId], references: [id])

  @@map("master_subdistricts")
}

model JobCategories {
  id        String    @id @default(uuid())
  code      String    @unique @db.VarChar(50)
  name      String    @unique @db.VarChar(100)
  image1    String?
  image2    String?
  image3    String?
  isActive  Boolean   @default(true)
  createdAt DateTime  @default(now()) @db.Timestamptz(3)
  updatedAt DateTime? @updatedAt @db.Timestamptz(3)

  @@map("job_categories")
}
